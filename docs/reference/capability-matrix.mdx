---
title: "Capability matrix"
description: "Build profiles, feature gates, error codes, and capability behavior across Meerkat configurations."
icon: "grid-2x2"
---

Meerkat is modular. Every feature is opt-in. This matrix shows what works in each build profile.

## Build profiles

| Profile | Cargo Features | Use Case |
|---------|---------------|----------|
| **Minimal** | `--no-default-features` | Ephemeral agent, no persistence, no compaction |
| **Persistent** | `session-store` | Sessions survive restart, redb-backed storage |
| **Compacting** | `session-compaction` | Auto-compact long conversations |
| **Full** | `session-store,session-compaction` | Persistent + compacting |

## Capability behavior

| Operation | Minimal | Persistent | Compacting | Full |
|-----------|---------|-----------|------------|------|
| `create_session` | Works | Works | Works | Works |
| `start_turn` | Works | Works + snapshot saved | Works | Works + snapshot saved |
| `interrupt` | Works | Works | Works | Works |
| `read` (live session) | Works | Works | Works | Works |
| `read` (archived) | `SESSION_NOT_FOUND` | Falls back to store | `SESSION_NOT_FOUND` | Falls back to store |
| `list` | Live sessions only | Live + stored sessions | Live sessions only | Live + stored sessions |
| `archive` | Removes from memory | Removes from memory, snapshot kept | Removes from memory | Removes + snapshot kept |
| Auto-compaction | No-op | No-op | Triggers at threshold | Triggers at threshold |

## Error codes

Deterministic error codes across all surfaces. The canonical mapping is defined in
`meerkat-contracts` (`ErrorCode`). Every `SessionError` variant maps to a stable
string code and a transport-specific representation:

| `SessionError` | Code | JSON-RPC | REST | MCP | CLI |
|----------------|------|----------|------|-----|-----|
| `NotFound` | `SESSION_NOT_FOUND` | -32001 | 404 | tool error | exit 10 |
| `Busy` | `SESSION_BUSY` | -32002 | 409 | tool error | exit 11 |
| `NotRunning` | `SESSION_NOT_RUNNING` | -32003 | 409 | tool error | exit 12 |
| `PersistenceDisabled` | `CAPABILITY_UNAVAILABLE` | -32020 | 501 | tool error | exit 40 |
| `CompactionDisabled` | `CAPABILITY_UNAVAILABLE` | -32020 | 501 | tool error | exit 40 |
| `Store` | `INTERNAL_ERROR` | -32603 | 500 | tool error | exit 1 |
| `Agent` | `AGENT_ERROR` | -32013 | 500 | tool error | exit 30 |

### Transport error mapping summary

- **JSON-RPC**: Custom error codes in the -32000..-32099 range. The `code` field of the
  JSON-RPC error object carries the string code (e.g. `SESSION_NOT_FOUND`).
- **REST**: HTTP status codes (404, 409, 500, 501). Error body includes `{ "code": "...", "message": "..." }`.
- **MCP Server**: Tool calls return `is_error: true` with the error message and code in the content.
- **CLI**: Non-zero exit codes. Each `ErrorCode` maps to a stable exit code (see [CLI exit codes](/cli/configuration#exit-codes)). Error details printed to stderr.

## Pick only what you need

```toml
# Minimal: just the agent loop
[dependencies]
meerkat = { version = "0.2", default-features = false, features = ["anthropic"] }

# Add persistence
meerkat = { version = "0.2", default-features = false, features = ["anthropic", "session-store"] }

# Add compaction
meerkat = { version = "0.2", default-features = false, features = ["anthropic", "session-store", "session-compaction"] }

# Kitchen sink
meerkat = { version = "0.2", features = ["all-providers", "session-store", "session-compaction", "comms", "mcp"] }
```

## Compaction behavior

When `session-compaction` is enabled:

- **Trigger**: `last_input_tokens >= threshold` OR `estimated_history_tokens >= threshold`
- **Guards**: Never on first turn. Minimum 3 turns between compactions.
- **Failure**: Non-fatal. `CompactionFailed` event emitted, agent continues with uncompacted history.
- **Budget**: Compaction LLM call draws from the same token budget as regular turns.

Events emitted: `CompactionStarted`, `CompactionCompleted`, `CompactionFailed`.

## Concurrency

- At most one turn runs per session at a time.
- Second `start_turn` while one is in-flight returns `SESSION_BUSY`.
- `interrupt()` cancels the in-flight turn.
- `read()` and `list()` are non-blocking.
- No queueing: callers retry on `Busy`.

## Durability

- **Ephemeral**: Process death loses all state.
- **Persistent**: Snapshot saved AFTER turn completes. Crash mid-turn loses the in-flight turn.
- `.rkat/sessions/` files are derived (projected) output, not canonical source. Deleting them
  and replaying from the event store produces identical content.

## See also

- [Session contracts](/reference/session-contracts) -- concurrency, durability, and compaction semantics
- [Architecture](/reference/architecture) -- crate structure and agent loop details
